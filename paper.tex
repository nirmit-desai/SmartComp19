\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{Large-scale peer-to-peer network for mobile platforms: Challenges and Experiences\\
\thanks{DAIS-ITA}
}

\author{\IEEEauthorblockN{Nirmit Desai}
\IEEEauthorblockA{\textit{IBM T. J. Watson Research Center} \\
%\textit{}\\
Yorktown Heights, NY, USA \\
nirmit.desai@us.ibm.com}
\and
\IEEEauthorblockN{Wendy Chong}
\IEEEauthorblockA{\textit{IBM T. J. Watson Research Center} \\
%\textit{name of organization (of Aff.)}\\
Yorktown Heights, NY, USA \\
wendych@us.ibm.com}
\and
\IEEEauthorblockN{Heather Achilles}
\IEEEauthorblockA{\textit{IBM T. J. Watson Research Center} \\
%\textit{name of organization (of Af}\\
Yorktown Heights, NY, USA \\
hachilles@us.ibm.com}
\and
\IEEEauthorblockN{Shahrokh Daijavad}
\IEEEauthorblockA{\textit{IBM T. J. Watson Research Center} \\
%\textit{Penn}\\
Yorktown Heights, NY, USA \\
shahrokh@us.ibm.com}
\and
\IEEEauthorblockN{Thomas La Porta}
\IEEEauthorblockA{\textit{Dept. of Computer Science and Engineering} \\
\textit{Penn State University}\\
University Park, PA, USA \\
tlp@cse.psu.edu}
%\and
%\IEEEauthorblockN{5\textsuperscript{th} Given Name Surname}
%\IEEEauthorblockA{\textit{dept. name of organization (of Aff.)} \\
%\textit{name of organization (of Aff.)}\\
%City, Country \\
%email address}
%\and
%\IEEEauthorblockN{6\textsuperscript{th} Given Name Surname}
%\IEEEauthorblockA{\textit{dept. name of organization (of Aff.)} \\
%\textit{name of organization (of Aff.)}\\
%City, Country \\
%email address}
}

\maketitle

\begin{abstract}
Peer-to-peer (p2p) networks and Mobile ad hoc networks (MANET) have been widely studied. However, a real-world deployment for the masses has remained elusive. Ever-increasing density of mobile devices, especially in urban areas, has given rise to new applications of p2p communication. However, the modern smartphone platforms have limited support for such communications. Further, the issues of battery life, range, and security remain unaddressed. A key question then is, what kinds of applications can the modern mobile platforms support and what challenges remain? This paper describes our experiences in deploying a real-world peer-to-peer delay-tolerant network to millions of users for relaying severe weather information, the challenges faced, and the approach taken.
\end{abstract}

\begin{IEEEkeywords}
peer-to-peer systems, mobile ad hoc network, delay-tolerant network
\end{IEEEkeywords}

\section{Introduction}
MANETs have been greatly studied given their decentralized nature and potential for new applications \cite{loo-manet-2011,perkins-ad-hoc-2001}. Most of the prior work has focused on valuable analytical and simulation-based study of MANET behavior \cite{zhang-topology-manet-2015,marti-misbehavior-manet-2000,mauve-pos-routing-manet-2001}. Given the outstanding practical challenges of physical nodes, real-world implementations have been limited and have not reached mass scale \cite{kiess-manet-impl-2007}. However, with the growth of smartphones, large-scale real-world implementations may become feasible. Mobile devices with programmable platforms such as android and iOS have steadily grown over the last decade, surpassing the 2 billion mark \footnote{https://www.statista.com/statistics/330695/number-of-smartphone-users-worldwide/}. This paper describes a real-world implementation of a p2p delay-tolerant network, called Mesh Network Alerts (MNA), for relaying severe weather information to millions of mobile device users as part of the Weather Channel app\footnote{https://weather.com/apps/ibm/meshnetworkalerts}. Specifically, we describe the key challenges in such an implementation, approaches taken to address them, experimental results, and a characterization of the outstanding challenges.

\section{Practical Challenges}
We focus on three main challenges and describe a system implementation for addressing them. One, even when a user is not interacting with the weather app, or worse yet, when the device is not being used at all, the devices must actively discover peer devices to send and receive potentially life-saving weather information. Although modern mobile operating systems such as Android and iOS offer APIs to discover and advertise information to peer devices over WiFi and Bluetooth interfaces, peer-to-peer connections do not work when the same APIs are accessed while the app is in the background. Prior works, widely document these challenges and take the approach of having special access on the devices, e.g., jail-breaking or rooting \cite{}. We overcame these challenges via innovative techniques, without resorting to hacks that may violate user security or Appstore guidelines. With our technique, exchange of information happens without making network connections. As we describe later, this is achieved by splitting the messages into small enough chunks so that they can be stuffed into service advertisements themselves and broadcast over multiple advertisements in a quick succession.

Two, since devices may be offline when new weather information arrives, MNA on each device must remain active at all times to be able to discover new information as soon as it arrives. However, the MNA activity must keep the device battery consumption to a minimum. This is a challenge because advertising and discovery are power-hungry operations over the radio channels. Our approach here is two-pronged. Firstly, via extensive experiments on a large number of devices, we fine-tune the algorithm governing the intervals at which discovery and advertisements occur. In a nutshell, receiving new information during a period causes MNA to be more aggressive in discovery and advertisement. Similarly, lack of new information for a period makes the device less aggressive. Secondly, we allow ``wake up'' messages to be broadcast in the network ahead of an anticipated severe weather event. When devices receive such messages, they schedule themselves to remain aggressive during the specified window of time. Outside of this window, the device can afford to have long sleep cycles and conserve power. With these techniques, our testing shows less than 1\% battery consumption per hour on most device models.

Three, given the heterogeneity of devices and operating system distributions in the market, it is quite a challenge to test whether MNA functions as expected on a given device. Further, running test scenarios on a p2p network at large-scale is non-trivial given that a large number of devices need to take specific coordinated action followed by coordinated observations to determine whether a test passes or fails. This is not a challenge in traditional mobile application development as the software is confined within a single connected device. We developed test automation tools and processes such that multiple devices can be controlled from a single test station and follow prescribed steps to generate, send, and receives messages to play out a test scenario. Finally, the framework allows automated analysis of the observations to determine the test result. This capability was instrumental in uncovering bugs at a fast pace to meet the aggressive timeline and avoid the cost of acquisition. Further, the automation framework is general and can be expressly applied to test other apps in this fashion.

Lastly, as devices with mesh advertise on a continuous basis, it may be possible for a malicious attacker to listen for such advertisements and reverse-engineer the message formats and protocols used. Then, the attackers may generate fake messages and advertise them, e.g., a fake tornado alert. Such false messages cannot be distinguished from the real ones, and MNA will end up propagating them to as many devices as possible, ``poisoning'' the network. In general, veracity of such information cannot be independently verified in open decentralized distributed systems and previous work on peer-to-peer networks do not address this challenge. In our approach, since the origin of weather information is the Weather Channel service, digital signatures can be attached to all weather alerts broadcast from the service. The mobile application is distributed with the corresponding public key so that digital signatures from the service can be verified. If a message fails such a verification, it is discarded and not forwarded any further.

\section{System Architecture}

\section{Experimental Results}

\begin{figure}[htbp]
\centerline{\includegraphics[width=\columnwidth]{figs/e2e_latency}}
\caption{End-to-end latency}
\label{fig:e2e}
\end{figure}

\begin{figure}[htbp]
\centerline{\includegraphics[width=\columnwidth]{figs/duplicates}}
\caption{Duplicity due to flooding}
\label{fig:dup}
\end{figure}

\begin{figure}[htbp]
\centerline{\includegraphics[width=\columnwidth]{figs/hops}}
\caption{Average hop count}
\label{fig:hop}
\end{figure}

\section*{Acknowledgment}

\bibliographystyle{abbrv}
\bibliography{smartcomp19}

\end{document}
